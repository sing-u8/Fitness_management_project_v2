<section class="l-sales">
    <div class="l-summary">
        <ng-container *ngrxLet="{ tm: saleSummaryThisMonth$, lm: saleSummaryLastMonth$ } as ms">
            <rwm-sale-summary
                [summaryType]="'currentMonth'"
                [curSummary]="ms.tm"
                [prevSummary]="ms.lm"
            ></rwm-sale-summary>
        </ng-container>
        <ng-container *ngrxLet="{ today: saleSummaryToday$, yesterday: saleSummaryYesterday$ } as ds">
            <rwm-sale-summary
                [summaryType]="'today'"
                [curSummary]="ds.today"
                [prevSummary]="ds.yesterday"
            ></rwm-sale-summary>
        </ng-container>
    </div>
    <div class="l-sale-table">
        <div class="l-sale-table-header">
            <div class="sale-table__title">ë§¤ì¶œ</div>
            <div class="l-sale-table-header-button">
                <div class="l-file-download-dropdown d-flex">
                    <rwa-ghost-button
                        class="download-button"
                        [height]="'42px'"
                        [bgColor]="'var(--red-5)'"
                        [hoverBgColor]="'var(--red-10)'"
                        [fontColor]="'var(--red-100)'"
                        [progressBgColor]="'var(--red-10)'"
                        [borderColor]="'var(--red-100)'"
                        [hoverBorderColor]="'var(--red-100)'"
                        [disableBgColor]="'#EEEEEE'"
                        [padding]="'7.5px 15px 5.5px 11px'"
                        [status]="fileDownLoadStatus"
                        (onClick)="showFileDownloadDropdown = !showFileDownloadDropdown"
                        (rwClickOutside)="showFileDownloadDropdown = false"
                    >
                        <ng-template gbtIdleContent>
                            <div class="sale-header-button__text red">
                                <div *ngIf="!showFileDownloadDropdown" class="file-download-icon--red"></div>
                                <div *ngIf="showFileDownloadDropdown" class="caret-up-1-icon--red"></div>
                                ì—‘ì…€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                            </div>
                        </ng-template>
                        <ng-template gbtPendingContent>
                            <div class="sale-header-button__text red">
                                <div *ngIf="!showFileDownloadDropdown" class="file-download-icon--red"></div>
                                <div *ngIf="showFileDownloadDropdown" class="caret-up-1-icon--red"></div>
                                ì—‘ì…€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                            </div>
                        </ng-template>
                    </rwa-ghost-button>
                    <div class="file-download-dropdown" [class.fdd-open]="showFileDownloadDropdown">
                        <rwa-button
                            [width]="'225px'"
                            [padding]="'8px 18px'"
                            [bgColor]="'var(--white)'"
                            [hoverBgColor]="'var(--gray-30)'"
                            [borderRadius]="'0'"
                            (onClick)="onFileDownLoad('filtered')"
                        >
                            <ng-template btIdleContent>
                                <span class="rw-type-r17">í•„í„°ë§í•œ ë¶€ë¶„ë§Œ ë‹¤ìš´ë¡œë“œ</span>
                            </ng-template>
                        </rwa-button>
                        <rwa-button
                            [width]="'225px'"
                            [padding]="'8px 18px'"
                            [bgColor]="'var(--white)'"
                            [hoverBgColor]="'var(--gray-30)'"
                            [borderRadius]="'0'"
                            (onClick)="onFileDownLoad('all')"
                        >
                            <ng-template btIdleContent>
                                <span class="rw-type-r17">í•„í„°ë§ ì—†ì´ ì „ì²´ ë‹¤ìš´ë¡œë“œ</span>
                            </ng-template>
                        </rwa-button>
                    </div>
                </div>
                <rwa-ghost-button [height]="'42px'" [padding]="'7.5px 15px 5.5px'" (onClick)="resetFilters()">
                    <ng-template gbtIdleContent>
                        <div class="sale-header-button__text red">í•„í„° ì´ˆê¸°í™”</div>
                    </ng-template>
                </rwa-ghost-button>
            </div>
        </div>
        <div class="l-sale-filter scroll-x-overlay">
            <ng-container *ngrxLet="dateFilter$ as df">
                <rwm-sale-filter
                    [filterType]="'date'"
                    [date]="df"
                    (dateChange)="onDateFilterChange($event)"
                    (onReset)="onResetFilter('date')"
                ></rwm-sale-filter>
            </ng-container>
            <ng-container *ngrxLet="typeCodeFilter$ as tf">
                <rwm-sale-filter
                    [filterType]="'paymentType'"
                    [paymentType]="tf"
                    (paymentTypeChange)="onTypeCodeFilterChange($event)"
                    (onReset)="onResetFilter('paymentType')"
                ></rwm-sale-filter>
            </ng-container>
            <ng-container *ngrxLet="memberFilter$ as mf">
                <rwm-sale-filter
                    [filterType]="'member'"
                    [member]="mf"
                    (memberChange)="onMemberFilterChange($event)"
                    (onReset)="onResetFilter('member')"
                ></rwm-sale-filter>
            </ng-container>
            <ng-container *ngrxLet="productTypeCodeFilter$ as ptf">
                <rwm-sale-filter
                    [filterType]="'productType'"
                    [productType]="ptf"
                    (productTypeChange)="onProductTypeCodeFilterChange($event)"
                    (onReset)="onResetFilter('productType')"
                ></rwm-sale-filter>
            </ng-container>
            <ng-container *ngrxLet="productNameFilter$ as pnf">
                <rwm-sale-filter
                    [filterType]="'productName'"
                    [productName]="pnf"
                    (productNameChange)="onProductNameFilterChange($event)"
                    (onReset)="onResetFilter('productName')"
                ></rwm-sale-filter>
            </ng-container>
            <ng-container *ngrxLet="personInChargeFilter$ as pf">
                <rwm-sale-filter
                    [filterType]="'personInCharge'"
                    [personInCharge]="pf"
                    (personInChargeChange)="onPersonInChargeFilterChange($event)"
                    (onReset)="onResetFilter('personInCharge')"
                ></rwm-sale-filter>
            </ng-container>
        </div>
        <div class="sale-table-summary">
            <ng-container *ngrxLet="salesInfoSummary$ as ss">
                <div class="l-payment-type-summary">
                    <div class="sale-table-summary-title">
                        <span class="title-margin">ê±°ë˜</span>
                        <span>{{ ss.rows | numberWithCommas }}ê±´</span>
                    </div>
                    <div class="payment-type-content">
                        <div class="summary-item">
                            <div class="type-text">ê²°ì œ</div>
                            <div class="value-text">{{ ss.payment_count | numberWithCommas }}ê±´</div>
                        </div>
                        <div class="plus-bold-gray70"></div>
                        <div class="summary-item">
                            <div class="type-text">í™˜ë¶ˆ</div>
                            <div class="value-text">{{ ss.refund_count | numberWithCommas }}ê±´</div>
                        </div>
                    </div>
                </div>
            </ng-container>
            <div class="l-payment-sale-summary">
                <div class="sale-table-summary-title">
                    <span class="title-margin">ê±°ë˜</span>
                    <span>{{ salesInfoTotalPrice | numberWithCommas }}ì›</span>
                </div>
                <div class="payment-sale-content" *ngrxLet="salesInfoSummary$ as ss">
                    <div class="summary-item">
                        <div class="type-text">ì¹´ë“œ</div>
                        <div class="value-text">{{ ss.sum_card | numberWithCommas }}ì›</div>
                        <div class="plus-bold-gray70"></div>
                    </div>
                    <div class="summary-item">
                        <div class="type-text">ì´ì²´</div>
                        <div class="value-text">{{ ss.sum_trans | numberWithCommas }}ì›</div>
                        <div class="plus-bold-gray70"></div>
                    </div>
                    <div class="summary-item">
                        <div class="type-text">í˜„ê¸ˆ</div>
                        <div class="value-text">{{ ss.sum_cash | numberWithCommas }}ì›</div>
                        <div class="plus-bold-gray70"></div>
                    </div>
                    <div class="summary-item">
                        <div class="type-text">ë¯¸ìˆ˜ê¸ˆ</div>
                        <div class="value-text">{{ ss.sum_unpaid | numberWithCommas }}ì›</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sale-table">
            <div class="sale-table-content scroll-y-overlay">
                <div class="sale-table-header">
                    <div class="sth-row">
                        <div class="sth-fixed-th header-text">
                            <div class="sth-col-1">ë‚ ì§œ</div>
                            <div class="sth-col-2">êµ¬ë¶„</div>
                            <div class="sth-col-3">íšŒì›</div>
                        </div>
                        <div class="sth-movable-th header-text">
                            <div class="sth-col-4">ìƒí’ˆ ìœ í˜•</div>
                            <div class="sth-col-5">ìƒí’ˆëª…</div>
                            <div class="sth-col-6">ê²°ì œ ë‹´ë‹¹ì</div>
                            <div class="sth-col-7">ê²°ì œ / í™˜ë¶ˆ ê¸ˆì•¡</div>
                        </div>
                    </div>
                </div>

                <ng-container *ngrxLet="{ saleLoading: salesLoading$, saleSummary: salesInfoSummary$ } as saleData">
                    <div
                        class="sale-table-body"
                        *ngIf="saleData.saleLoading != 'pending' && saleData.saleSummary.rows > 0"
                    >
                        <ng-container *ngrxLet="sales$ as sale">
                            <div class="stb-row" *ngFor="let item of sale">
                                <div class="stb-fixed-td body-text">
                                    <div class="sth-col-1">{{ item.date | dateFormat : 'YYYY.MM.DD' }}</div>
                                    <div class="sth-col-2">{{ item.type_code_name }}</div>
                                    <div class="sth-col-3">
                                        <div class="col-3-name">{{ item.center_user_name }}</div>
                                        <div class="col-3-phone">{{ item.center_user_phone_number | phoneNumber }}</div>
                                    </div>
                                </div>
                                <div class="stb-movable-td body-text">
                                    <div class="sth-col-4">{{ item.product_type_code_name }}</div>
                                    <div class="sth-col-5">
                                        <span rwEllipsisDropdown [lineClamp]="2" [edText]="item.product_name">
                                            <!--                                            {{ item.product_name }}-->
                                        </span>
                                    </div>
                                    <div class="sth-col-6">
                                        <div class="col-6-name">{{ item.responsibility_center_user_name }}</div>
                                        <div class="col-6-phone">
                                            {{ item.responsibility_center_user_phone_number | phoneNumber }}
                                        </div>
                                    </div>
                                    <div class="sth-col-7 sth-col-7-right">
                                        <div class="l-col-7-value">
                                            <div class="col-7-price">
                                                {{
                                                    item.card + item.cash + item.trans + item.unpaid | numberWithCommas
                                                }}ì›
                                                <div class="col-7-price-dropdown">
                                                    <div class="col-7-price-dropdown__item">
                                                        <span class="categ">ì¹´ë“œ</span>
                                                        <span class="price">{{ item.card | numberWithCommas }}ì›</span>
                                                    </div>
                                                    <div class="col-7-price-dropdown__item">
                                                        <span class="categ">ì´ì²´</span>
                                                        <span class="price">{{ item.trans | numberWithCommas }}ì›</span>
                                                    </div>
                                                    <div class="col-7-price-dropdown__item">
                                                        <span class="categ">í˜„ê¸ˆ</span>
                                                        <span class="price">{{ item.cash | numberWithCommas }}ì›</span>
                                                    </div>
                                                    <div class="col-7-price-dropdown__item">
                                                        <span class="categ">ë¯¸ìˆ˜ê¸ˆ</span>
                                                        <span class="price"
                                                            >{{ item.unpaid | numberWithCommas }}ì›</span
                                                        >
                                                    </div>
                                                </div>
                                            </div>
                                            <div *ngIf="item.unpaid && item.unpaid > 0" class="col-7-unpaid">
                                                ë¯¸ìˆ˜ê¸ˆ {{ item.unpaid | numberWithCommas }}ì›
                                            </div>
                                        </div>
                                        <div class="caret-circle-down-icon"></div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <div class="sale-table-body justify-content-center" *ngIf="saleData.saleLoading == 'pending'">
                        <ngx-spinner
                            [style.z-index]="100"
                            type="ball-clip-rotate"
                            [size]="'small'"
                            [color]="'var(--gray-80)'"
                            [bdColor]="'transparent'"
                            [fullScreen]="false"
                            [name]="'sale-table-loading'"
                            [showSpinner]="true"
                        >
                        </ngx-spinner>
                    </div>
                    <div
                        class="sale-table-body justify-content-center"
                        *ngIf="saleData.saleLoading != 'pending' && saleData.saleSummary.rows < 1"
                    >
                        <div class="stb-row-empty" *ngIf="!filterApplied">
                            <div class="stb-row-empty__text sre-margin">ğŸ’° ë§¤ì¶œ ì •ë³´ê°€ ì—†ì–´ìš”.</div>
                            <div class="stb-row-empty__text">
                                íšŒì›ì—ê²Œ ìƒí’ˆì„ íŒë§¤í•œ í›„,<br />
                                ì´ê³³ì—ì„œ ë§¤ì¶œì„ ê´€ë¦¬í•´ ë³´ì„¸ìš”.
                            </div>
                        </div>
                        <div class="stb-row-empty" *ngIf="filterApplied">
                            <div class="stb-row-empty__text">
                                ğŸ” ì¡°ê±´ì— ë§ëŠ” ë§¤ì¶œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”.<br />
                                ì„¤ì •í•œ í•„í„°ê°’ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.
                            </div>
                            <rwa-ghost-button
                                [padding]="'7.5px 15px 5.5px'"
                                [height]="'42px'"
                                (onClick)="resetFilters()"
                            >
                                <ng-template gbtIdleContent>
                                    <span class="filter-reset-text">í•„í„° ì´ˆê¸°í™”</span>
                                </ng-template>
                            </rwa-ghost-button>
                        </div>
                    </div>
                </ng-container>
            </div>

            <ng-container *ngrxLet="salesInfoSummary$ as sis">
                <div class="sale-table-page" *ngIf="sis.rows > 0">
                    <rwa-page-button
                        [pageNumber]="pageNumber"
                        [pageUnit]="10"
                        [selectedPageNumber]="selectedPageNumber"
                        (onPageNumberClick)="onPageNumberClick($event)"
                    ></rwa-page-button>
                </div>
            </ng-container>
        </div>
    </div>
</section>
